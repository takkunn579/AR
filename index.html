<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame Snapshot Example</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- html2canvasを利用してHTML全体をスクショ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      body, html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #000;
      }
      #snapshotBtn {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        font-size: 16px;
        background: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <!-- A-Frameシーン -->
    <a-scene id="scene" embedded>
      <a-assets>
        <img id="bg" src="https://cdn.aframe.io/a-painter/images/sky.jpg">
      </a-assets>
      <a-sky src="#bg"></a-sky>
      <a-box position="0 1.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="2 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>
      <a-entity camera look-controls></a-entity>
    </a-scene>

    <!-- 撮影ボタン -->
    <button id="snapshotBtn">📷 撮影＆ダウンロード</button>

    <script>
      document.getElementById("snapshotBtn").addEventListener("click", async () => {
        try {
          const scene = document.getElementById("scene");

          // html2canvasでA-Frameシーン全体をキャプチャ
          const canvas = await html2canvas(scene, {
            useCORS: true,
            backgroundColor: null // 透明や背景を正しく取る
          });

          // DataURL化
          const dataURL = canvas.toDataURL("image/png");

          // ダウンロードリンク作成
          const link = document.createElement("a");
          link.href = dataURL;
          link.download = "snapshot.png";
          link.click();

        } catch (err) {
          console.error("撮影エラー:", err);
          alert("スクショ中にエラーが発生しました。");
        }
      });
    </script>
  </body>
</html>
