<html>
  <head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin:0; overflow:hidden;">

    <!-- A-Frame + AR.js ã‚·ãƒ¼ãƒ³ -->
    <a-scene
      vr-mode-ui="enabled: false;"
      embedded
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
      
      <a-assets>
        <a-asset-item id="model1" src="assets/model1.glb"></a-asset-item>
      </a-assets>

      <!-- ãƒãƒ¼ã‚«ãƒ¼ã«ãƒ¢ãƒ‡ãƒ«ã‚’è¡¨ç¤º -->
      <a-marker type="pattern" url="assets/marker1.patt">
        <a-entity
          gltf-model="#model1"
          scale="0.5 0.5 0.5"
          rotation="0 180 0"
          position="0 0 0">
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- æ’®å½±ãƒœã‚¿ãƒ³ -->
    <button id="snapshotBtn" 
      style="position: absolute; top: 20px; left: 20px; padding:10px; font-size:16px; z-index:10;">
      ğŸ“¸ æ’®å½±
    </button>

    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
    <div id="previewContainer" 
         style="position:absolute; top:70px; left:20px; display:none; z-index:10; background:rgba(0,0,0,0.7); padding:10px; border-radius:5px;">
      <img id="previewImage" style="max-width:300px; display:block; margin-bottom:10px;">
      <button id="downloadBtn" style="margin-right:10px;">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      <button id="deleteBtn">âŒ å‰Šé™¤</button>
    </div>

    <script>
      const sceneEl = document.querySelector('a-scene');
      const snapshotBtn = document.getElementById('snapshotBtn');
      const previewContainer = document.getElementById('previewContainer');
      const previewImage = document.getElementById('previewImage');
      const downloadBtn = document.getElementById('downloadBtn');
      const deleteBtn = document.getElementById('deleteBtn');

      snapshotBtn.addEventListener('click', () => {
        try {
          const canvas = sceneEl.renderer.domElement;
          const dataURL = canvas.toDataURL("image/png");

          previewImage.src = dataURL;
          previewContainer.style.display = "block";

          downloadBtn.onclick = () => {
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = "snapshot.png";
            link.click();
          };

          deleteBtn.onclick = () => {
            previewContainer.style.display = "none";
            previewImage.src = "";
          };
        } catch (err) {
          console.error("æ’®å½±ã‚¨ãƒ©ãƒ¼:", err);
        }
      });
    </script>
  </body>
</html>
