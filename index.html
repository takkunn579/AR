<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Simple AR</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
  <a-scene
    vr-mode-ui="enabled: false;"
    renderer="logarithmicDepthBuffer: true; preserveDrawingBuffer: true;"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    embedded
  >
    <a-assets>
      <a-asset-item id="model1" src="assets/model3.glb"></a-asset-item>
    </a-assets>

    <a-marker type="pattern" url="assets/marker1.patt">
      <a-entity
        gltf-model="#model1"
        scale="0.5 0.5 0.5"
        rotation="-90 0 0"
        position="0 0 0"
      ></a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <button id="snapshotBtn" style="position: absolute; top: 20px; left: 20px; padding: 10px; font-size: 16px; z-index: 10;">
    ğŸ“¸ æ’®å½±
  </button>

  <div id="previewContainer" style="position: absolute; top: 70px; left: 20px; display: none; z-index: 10; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px;">
    <img id="previewImage" style="max-width: 200px; display: block; margin-bottom: 10px;">
    <button id="downloadBtn" style="margin-right: 10px;">ğŸ’¾ ä¿å­˜</button>
    <button id="closeBtn">âŒ é–‰ã˜ã‚‹</button>
  </div>

  <script>
    // å¿…è¦ãªHTMLè¦ç´ ã‚’å–å¾—
    const sceneEl = document.querySelector('a-scene');
    const snapshotBtn = document.getElementById('snapshotBtn');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');
    const downloadBtn = document.getElementById('downloadBtn');
    const closeBtn = document.getElementById('closeBtn');

    // ã€Œæ’®å½±ã€ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã®å‡¦ç†
    snapshotBtn.addEventListener('click', () => {
      // sceneEl.renderer.domElement ã¯ARã®æ˜ åƒãŒæç”»ã•ã‚Œã¦ã„ã‚‹å ´æ‰€ï¼ˆcanvasè¦ç´ ï¼‰
      // .toDataURL() ã§ã€canvasã®ç¾åœ¨ã®è¡¨ç¤ºã‚’ç”»åƒãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å–å¾—ã™ã‚‹
      const imageData = sceneEl.renderer.domElement.toDataURL('image/png');
      
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®imgè¦ç´ ã«ã€å–å¾—ã—ãŸç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
      previewImage.src = imageData;
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤ºã™ã‚‹
      previewContainer.style.display = 'block';

      // ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’å®Ÿè¡Œ
      downloadBtn.onclick = () => {
        const link = document.createElement('a');
        link.href = imageData;
        link.download = 'ar_snapshot.png'; // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å
        link.click();
      };

      // ã€Œé–‰ã˜ã‚‹ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’éè¡¨ç¤ºã«ã™ã‚‹
      closeBtn.onclick = () => {
        previewContainer.style.display = 'none';
      };
    });
  </script>
</body>
</html>
