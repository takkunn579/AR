<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Photo Booth</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚ˆã‚Šæ–°ã—ãå®‰å®šã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–° -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <!-- ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ï¼ˆãƒ”ãƒ³ãƒæ“ä½œãªã©ï¼‰ç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>

    <style>
        /* æ’®å½±å¾Œã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #preview {
            /* æœ€åˆã¯éè¡¨ç¤ºã«ã—ã¦ãŠã */
            display: none; 
            
            /* ç”»é¢å…¨ä½“ã‚’è¦†ã†é»’ã„åŠé€æ˜ã®èƒŒæ™¯ */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 10000; /* å¸¸ã«æœ€å‰é¢ã«è¡¨ç¤º */

            /* ä¸­ã®è¦ç´ ã‚’ä¸­å¤®ã«é…ç½® */
            justify-content: center;
            align-items: center;
            flex-direction: column; /* è¦ç´ ã‚’ç¸¦ã«ä¸¦ã¹ã‚‹ */
        }

        /* æ’®å½±ã—ãŸç”»åƒã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #preview img {
            max-width: 90%; /* ç”»é¢å¹…ã®90%ã‚’æœ€å¤§å¹…ã« */
            max-height: 70%; /* ç”»é¢é«˜ã•ã®70%ã‚’æœ€å¤§é«˜ã« */
            border: 2px solid white;
            border-radius: 8px;
        }

        /* æ“ä½œæ¡ˆå†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
        #preview p {
            color: white;
            font-size: 18px;
            font-family: sans-serif;
            margin-top: 20px;
            font-weight: bold;
        }

        /* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #closeBtn {
            margin-top: 15px;
            padding: 12px 25px;
            font-size: 16px;
            background-color: #333;
            color: white;
            border: 1px solid white;
            border-radius: 20px;
            cursor: pointer;
        }

        /* æ’®å½±ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #captureBtn {
            position: absolute;
            bottom: 30px; /* ä½ç½®ã‚’ä¸‹ã«å¤‰æ›´ */
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            padding: 0;
            width: 70px; /* å††å½¢ã«ã™ã‚‹ */
            height: 70px;
            border-radius: 50%;
            font-size: 30px;
            background-color: white;
            border: 5px solid rgba(0, 0, 0, 0.3);
            box-sizing: border-box;
        }
    </style>
</head>

<body style="margin: 0; overflow: hidden;">
    <!-- ğŸ“· æ’®å½±ãƒœã‚¿ãƒ³ -->
    <button id="captureBtn">ğŸ“·</button>

    <!-- ã€å¤‰æ›´ç‚¹1ã€‘æ’®å½±ã—ãŸç”»åƒã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã™ã‚‹ãŸã‚ã®é ˜åŸŸã‚’è¿½åŠ  -->
    <div id="preview">
        <img id="previewImage" src="" alt="ã‚­ãƒ£ãƒ—ãƒãƒ£ç”»åƒ">
        <p>ç”»åƒã‚’é•·æŠ¼ã—ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„</p>
        <button id="closeBtn">é–‰ã˜ã‚‹</button>
    </div>

    <!-- ARã‚·ãƒ¼ãƒ³ -->
    <a-scene
        vr-mode-ui="enabled: false;"
        loading-screen="enabled: false;"
        renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true;"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
        embedded
        gesture-detector
    >
        <a-assets>
             <!-- è¤‡æ•°ãƒ¢ãƒ‡ãƒ« -->
             <!-- æ³¨æ„: å¤–éƒ¨ã‚µã‚¤ãƒˆã®ãƒ¢ãƒ‡ãƒ«ã¯CORSè¨­å®šãŒãªã„ã¨èª­ã¿è¾¼ã‚ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ -->
             <a-asset-item id="model1" src="assets/model1.glb"></a-asset-item>
             <a-asset-item id="model2" src="assets/model2.glb"></a-asset-item>
             <a-asset-item id="model3" src="assets/model3.glb"></a-asset-item>
        </a-assets>

        <!-- ãƒãƒ¼ã‚«ãƒ¼1 â†’ model1 -->
        <a-marker type="pattern" url="assets/marker1.patt">
             <a-entity gltf-model="#model1" scale="0.5 0.5 0.5" gesture-handler></a-entity>
        </a-marker>

        <!-- ãƒãƒ¼ã‚«ãƒ¼2 â†’ model2 -->
        <a-marker type="pattern" url="assets/marker2.patt">
             <a-entity gltf-model="#model2" scale="0.5 0.5 0.5" gesture-handler></a-entity>
        </a-marker>

        <!-- ãƒãƒ¼ã‚«ãƒ¼3 â†’ model3 -->
        <a-marker type="pattern" url="assets/marker3.patt">
             <a-entity gltf-model="#model3" scale="0.5 0.5 0.5" gesture-handler></a--entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <!-- ã€å¤‰æ›´ç‚¹2ã€‘æ’®å½±ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ã¯ãªããƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ -->
    <script>
        const captureBtn = document.getElementById("captureBtn");
        const preview = document.getElementById("preview");
        const previewImage = document.getElementById("previewImage");
        const closeBtn = document.getElementById("closeBtn");

        captureBtn.addEventListener("click", () => {
            const sceneEl = document.querySelector("a-scene");
            // preserveDrawingBuffer: true ãŒå¿…è¦
            const canvas = sceneEl.canvas;
            
            // ç”»é¢ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦ç”»åƒãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›
            const dataURL = canvas.toDataURL("image/png");
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®imgã‚¿ã‚°ã«ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
            previewImage.src = dataURL;
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã‚’è¡¨ç¤º
            preview.style.display = "flex";
        });

        // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã‚’éè¡¨ç¤ºã«ã™ã‚‹
        closeBtn.addEventListener("click", () => {
            preview.style.display = "none";
        });
    </script>
</body>
</html>

